<!DOCTYPE html>
<html>
<head>
    <title>IPYNB to PDF Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #status { margin-top: 10px; color: #666; }
    </style>
</head>
<body>
    <h1>Jupyter Notebook to PDF Converter</h1>
    <input type="file" id="ipynbFiles" multiple accept=".ipynb">
    <div id="status">Select one or more .ipynb files</div>

    <script>
        const { jsPDF } = window.jspdf;
        
        document.getElementById('ipynbFiles').addEventListener('change', async function(e) {
            const files = e.target.files;
            const statusDiv = document.getElementById('status');
            
            for (const file of files) {
                statusDiv.textContent = `Processing ${file.name}...`;
                
                try {
                    const content = await readFile(file);
                    const notebook = JSON.parse(content);
                    const pdf = new jsPDF();
                    
                    // PDF configuration
                    const lineHeight = 7;
                    const margin = 10;
                    let yPos = margin;
                    let page = 1;
                    
                    pdf.setFont('helvetica');
                    pdf.setFontSize(12);
                    
                    // Process notebook cells
                    notebook.cells.forEach((cell, index) => {
                        const cellContent = cell.source.join('\n').replace(/\\n/g, '\n');
                        const isCode = cell.cell_type === 'code';
                        
                        // Add cell type header
                        pdf.setFont(isCode ? 'courier' : 'helvetica', 'bold');
                        pdf.text(`${isCode ? 'CODE CELL' : 'MARKDOWN CELL'} (${index + 1})`, 
                                margin, yPos);
                        yPos += lineHeight;
                        
                        // Add cell content
                        pdf.setFont(isCode ? 'courier' : 'helvetica', 'normal');
                        const lines = pdf.splitTextToSize(cellContent, 180);
                        
                        lines.forEach(line => {
                            if (yPos > 280) {  // Add new page
                                pdf.addPage();
                                page++;
                                yPos = margin;
                            }
                            pdf.text(line, margin, yPos);
                            yPos += lineHeight;
                        });
                        
                        yPos += lineHeight;  // Add space between cells
                    });

                    // Save PDF
                    pdf.save(`${file.name.replace('.ipynb', '')}.pdf`);
                    statusDiv.textContent = `Converted ${files.length} files!`;
                    
                } catch (error) {
                    statusDiv.textContent = `Error processing ${file.name}: ${error}`;
                    console.error(error);
                }
            }
        });

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsText(file);
            });
        }
    </script>
</body>
</html>